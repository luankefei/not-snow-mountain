<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>绘图测试</title>
  </head>
  <body>
    <script src="./dist/index.js"></script>
    <script>
      const game = new $.Game();
      const canvas = game.canvas;
      const context = game.context;

      const image = new Image();
      image.src = "./static/running_sprite_sheet.png";
      image.onload = () => {
        const sprite = init();
        animate(sprite);
      };
      const runnerCells = [
        { x: 0, y: 0, width: 47, height: 64 },
        { x: 55, y: 0, width: 44, height: 64 },
        { x: 107, y: 0, width: 39, height: 64 },
        { x: 150, y: 0, width: 46, height: 64 },
        { x: 208, y: 0, width: 49, height: 64 },
        { x: 265, y: 0, width: 46, height: 64 },
        { x: 320, y: 0, width: 42, height: 64 },
        { x: 380, y: 0, width: 35, height: 64 },
        { x: 425, y: 0, width: 35, height: 64 },
      ];

      // const runInPlace = {
      //   lastAdvance: 0,
      //   PAGEFLIP_INTERVAL: 100,

      //   execute: function (sprite, context, now) {
      //     if (now - this.lastAdvance > this.PAGEFLIP_INTERVAL) {
      //       sprite.painter.advance();
      //       this.lastAdvance = now;
      //     }
      //   },
      // };

      const painter = new $.Painter.SpriteSheetPainter(runnerCells, image);

      function init() {
        const sprite = new $.Sprite("runner", painter, [runInPlace]);
        return sprite;
      }

      function drawBackround() {
        context.save();
        context.fillStyle = "rgb(230,230,230)";
        context.fillRect(0, 0, canvas.width, canvas.height);
        context.restore();
      }

      function animate(sprite) {
        context.clearRect(0, 0, canvas.width, canvas.height);
        drawBackround();
        sprite.paint(context);
        sprite.update(context, Date.now());

        requestAnimationFrame(() => animate(sprite));

        // sprite.advance();

        // loop
        // requestAnimationFrame
      }
      // running_sprite_sheet.png
      // const sprite = new Sprite("runner", new SpriteSheetPainter(runnerCells));

      // function createCanvas(width, height) {
      //   const node = document.createElement("canvas");
      //   node.width = width || screen.availWidth;
      //   node.height = height || screen.availHeight;
      //   node.id = "canvas";
      //   document.body.appendChild(node);

      //   return node;
      // }

      // function getCanvasElementById(id) {
      //   let canvas = document.getElementById(id);
      //   if (!canvas || canvas.constructor !== HTMLCanvasElement) {
      //     throw new TypeError(
      //       `The element of id "${id}" is not a HTMLCanvasElement. Make sure a <canvas id="${id}""> element is present in the document.`
      //     );
      //   }
      //   return canvas;
      // }

      // var node = createCanvas();
      // console.log(node);
      // console.log(node === getCanvasElementById(node.id));
    </script>
  </body>
</html>
